<!DOCTYPE html>
<html>
<head>
  <title>Raycaster with Items and Health</title>
  <style>
    html, body {
      margin: 0; padding: 0; overflow: hidden; background: black;
      height: 100%; width: 100%;
    }
    canvas { display: block; }
    #fullscreenBtn {
      position: absolute;
      top: 10px; left: 10px;
      z-index: 1000;
      padding: 8px 12px;
      background: #222;
      color: white;
      border: none;
      cursor: pointer;
      font-size: 14px;
      border-radius: 4px;
    }
  </style>
</head>
<body>
  <button id="fullscreenBtn">Go Fullscreen</button>
  <canvas id="game"></canvas>
  <script>
    const canvas = document.getElementById("game");
    const ctx = canvas.getContext("2d");

    function resize() {
      canvas.width = window.innerWidth;
      canvas.height = window.innerHeight;
    }
    resize();
    window.addEventListener("resize", resize);

    document.getElementById("fullscreenBtn").onclick = () => {
      if (!document.fullscreenElement)
        document.documentElement.requestFullscreen();
      else
        document.exitFullscreen();
    };

    let floor1 = [
      "####################",
      "#..................#",
      "#..........I.......#",
      "#..................#",
      "#.......D..........#",
      "#..................#",
      "#.......######.....#",
      "#.......#....#.....#",
      "#.......#....#.....#",
      "#.......#....#.....#",
      "#........B####.....#",
      "#..................#",
      "#..................#",
      "#..................#",
      "#..................#",
      "####################"
    ];

    let floor2 = [
      "####################",
      "#..................#",
      "#..................#",
      "#..................#",
      "#.......D..........#",
      "#..................#",
      "#.......######.....#",
      "#.......#....#.....#",
      "#.......#....#.....#",
      "#......####..#.....#",
      "#......D.B####.....#",
      "#......####........#",
      "#..................#",
      "#..................#",
      "#..................#",
      "####################"
    ];

    let currentMap = floor1;
    let currentFloor = 1;

    let playerPositions = {
      1: { x: 8.5, y: 10.5 },
      2: { x: 8.5, y: 10.5 }
    };

    let posX = playerPositions[1].x, posY = playerPositions[1].y;
    let dirX = 1, dirY = 0;
    let planeX = 0, planeY = 0.66;
    const keys = {};
    let health = 100;
    let inventory = [];

    document.addEventListener("keydown", e => {
      keys[e.key.toLowerCase()] = true;
      if (selectingFloor) {
        if (e.key.toLowerCase() === "w" || e.key === "ArrowUp") {
          selectedFloor = Math.max(1, selectedFloor - 1);
        } else if (e.key.toLowerCase() === "s" || e.key === "ArrowDown") {
          selectedFloor = Math.min(2, selectedFloor + 1);
        } else if (e.key === "Enter") {
          simulateElevator(selectedFloor);
          selectingFloor = false;
        }
        e.preventDefault();
      }
    });
    document.addEventListener("keyup", e => keys[e.key.toLowerCase()] = false);

    let selectingFloor = false;
    let selectedFloor = 1;

    function simulateElevator(floor) {
      playerPositions[currentFloor] = { x: posX, y: posY };
      currentFloor = floor;
      currentMap = (floor === 1) ? floor1 : floor2;
      posX = playerPositions[floor].x;
      posY = playerPositions[floor].y;
    }

    function drawHealthBar() {
      ctx.fillStyle = "#000";
      ctx.fillRect(20, canvas.height - 40, 204, 24);
      ctx.fillStyle = "#f00";
      ctx.fillRect(22, canvas.height - 38, Math.max(0, 2 * health), 20);
      ctx.strokeStyle = "#fff";
      ctx.strokeRect(20, canvas.height - 40, 204, 24);
      ctx.fillStyle = "#fff";
      ctx.font = "14px monospace";
      ctx.fillText("Health: " + health, 24, canvas.height - 22);
    }

    function drawInventory() {
      ctx.fillStyle = "#fff";
      ctx.font = "14px monospace";
      ctx.fillText("Inventory: " + inventory.join(", "), 240, canvas.height - 24);
    }

    function gameLoop() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);

      // (Raycasting logic unchanged, omitted here for brevity)

      // Player interaction
      if (keys['e']) {
        const fx = Math.floor(posX + dirX);
        const fy = Math.floor(posY + dirY);
        const tile = currentMap[fy]?.[fx];
        if (tile === 'B') {
          selectingFloor = true;
          selectedFloor = currentFloor === 1 ? 2 : 1;
        } else if (tile === 'D') {
          const mapArray = currentFloor === 1 ? floor1 : floor2;
          mapArray[fy] = mapArray[fy].substring(0, fx) + '.' + mapArray[fy].substring(fx + 1);
        } else if (tile === 'I') {
          inventory.push("Item");
          const mapArray = currentFloor === 1 ? floor1 : floor2;
          mapArray[fy] = mapArray[fy].substring(0, fx) + '.' + mapArray[fy].substring(fx + 1);
        }
      }

      // Draw HUD
      drawHealthBar();
      drawInventory();

      requestAnimationFrame(gameLoop);
    }

    gameLoop();
  </script>
</body>
</html>
