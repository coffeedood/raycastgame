<!DOCTYPE html>
<html>
<head>
  <title>Mini Doom Raycasting Game with Doors</title>
  <style>
    html, body {
      margin: 0; padding: 0; overflow: hidden; background: black; height: 100%; width: 100%;
      color: white; font-family: Arial, sans-serif;
    }
    canvas {
      display: block;
      position: absolute;
      top: 0; left: 0;
    }
    #fullscreenBtn {
      position: absolute;
      top: 10px; left: 10px;
      z-index: 1000;
      padding: 8px 12px;
      background: #222;
      color: white;
      border: none;
      cursor: pointer;
      font-size: 14px;
      border-radius: 4px;
    }
    #fullscreenBtn:hover {
      background: #444;
    }
  </style>
</head>
<body>
  <button id="fullscreenBtn">Go Fullscreen</button>
  <canvas id="game"></canvas>

  <script>
    const canvas = document.getElementById('game');
    const ctx = canvas.getContext('2d');

    function resize() {
      canvas.width = window.innerWidth;
      canvas.height = window.innerHeight;
    }
    resize();
    window.addEventListener('resize', resize);

    // Fullscreen toggle button
    const fullscreenBtn = document.getElementById('fullscreenBtn');
    fullscreenBtn.addEventListener('click', () => {
      if (document.fullscreenElement) {
        document.exitFullscreen();
      } else {
        document.documentElement.requestFullscreen();
      }
    });

    // Load textures
    const wallTexture = new Image();
    wallTexture.src = 'wall.png'; // Replace with your wall texture path

    const doorTexture = new Image();
    doorTexture.src = 'door.png'; // Replace with your door texture path

    // Simple raycasting game map
    const map = [
      "########",
      "#......#",
      "#..##..#",
      "#..D...#",
      "###..###",
      "#......#",
      "#......#",
      "########"
    ];
    const mapWidth = map[0].length;
    const mapHeight = map.length;

    let posX = 3.5, posY = 3.5;
    let dirX = 1, dirY = 0;
    let planeX = 0, planeY = 0.66;

    const keys = {};
    document.addEventListener('keydown', e => {
      keys[e.key.toLowerCase()] = true;
      if (e.key.toLowerCase() === 'e') {
        interact();
      }
    });
    document.addEventListener('keyup', e => keys[e.key.toLowerCase()] = false);

    function interact() {
      const facingX = Math.floor(posX + dirX);
      const facingY = Math.floor(posY + dirY);
      if (map[facingY][facingX] === 'D') {
        map[facingY] = map[facingY].substring(0, facingX) + 'O' + map[facingY].substring(facingX + 1);
      } else if (map[facingY][facingX] === 'O') {
        map[facingY] = map[facingY].substring(0, facingX) + 'D' + map[facingY].substring(facingX + 1);
      }
    }

    function gameLoop() {
      const w = canvas.width;
      const h = canvas.height;

      ctx.fillStyle = 'black';
      ctx.fillRect(0, 0, w, h);

      for (let x = 0; x < w; x++) {
        const cameraX = 2 * x / w - 1;
        const rayDirX = dirX + planeX * cameraX;
        const rayDirY = dirY + planeY * cameraX;

        let mapX = Math.floor(posX);
        let mapY = Math.floor(posY);

        let sideDistX, sideDistY;

        const deltaDistX = Math.abs(1 / rayDirX);
        const deltaDistY = Math.abs(1 / rayDirY);
        let perpWallDist;

        let stepX, stepY;
        let hit = 0, side;
        let hitType = '';

        if (rayDirX < 0) {
          stepX = -1;
          sideDistX = (posX - mapX) * deltaDistX;
        } else {
          stepX = 1;
          sideDistX = (mapX + 1.0 - posX) * deltaDistX;
        }

        if (rayDirY < 0) {
          stepY = -1;
          sideDistY = (posY - mapY) * deltaDistY;
        } else {
          stepY = 1;
          sideDistY = (mapY + 1.0 - posY) * deltaDistY;
        }

        while (hit === 0) {
          if (sideDistX < sideDistY) {
            sideDistX += deltaDistX;
            mapX += stepX;
            side = 0;
          } else {
            sideDistY += deltaDistY;
            mapY += stepY;
            side = 1;
          }
          const cell = map[mapY][mapX];
          if (cell === '#' || cell === 'D') {
            hit = 1;
            hitType = cell;
          } else if (cell === 'O') {
            // Open door, treat as empty space
          } else {
            // Empty space
          }
        }

        if (side === 0) perpWallDist = (mapX - posX + (1 - stepX) / 2) / rayDirX;
        else perpWallDist = (mapY - posY + (1 - stepY) / 2) / rayDirY;

        const lineHeight = Math.floor(h / perpWallDist);
        let drawStart = -lineHeight / 2 + h / 2;
        let drawEnd = lineHeight / 2 + h / 2;

        if (drawStart < 0) drawStart = 0;
        if (drawEnd >= h) drawEnd = h - 1;

        if (hitType === '#') {
          ctx.fillStyle = side === 1 ? '#888' : '#aaa';
          ctx.fillRect(x, drawStart, 1, drawEnd - drawStart);
        } else if (hitType === 'D') {
          ctx.fillStyle = side === 1 ? '#444' : '#666';
          ctx.fillRect(x, drawStart, 1, drawEnd - drawStart);
        }
      }

      const moveSpeed = 0.05;
      const rotSpeed = 0.03;

      if (keys['arrowup'] || keys['w']) {
        const newX = posX + dirX * moveSpeed;
        const newY = posY + dirY * moveSpeed;
        if (map[Math.floor(posY)][Math.floor(newX)] === '.') posX = newX;
        if (map[Math.floor(newY)][Math.floor(posX)] === '.') posY = newY;
      }
      if (keys['arrowdown'] || keys['s']) {
        const newX = posX - dirX * moveSpeed;
        const newY = posY - dirY * moveSpeed;
        if (map[Math.floor(posY)][Math.floor(newX)] === '.') posX = newX;
        if (map[Math.floor(newY)][Math.floor(posX)] === '.') posY = newY;
      }
      if (keys['arrowright'] || keys['d']) {
        const oldDirX = dirX;
        dirX = dirX * Math.cos(-rotSpeed) - dirY * Math.sin(-rotSpeed);
        dirY = oldDirX * Math.sin(-rotSpeed) + dirY * Math.cos(-rotSpeed);
        const oldPlaneX = planeX;
        planeX = planeX * Math.cos(-rotSpeed) - planeY * Math.sin(-rotSpeed);
        planeY = oldPlaneX * Math.sin(-rotSpeed) + planeY * Math.cos(-rotSpeed);
      }
      if (keys['arrowleft'] || keys['a']) {
        const oldDirX = dirX;
        dirX = dirX * Math.cos(rotSpeed) - dirY * Math.sin(rotSpeed);
        dirY = oldDirX * Math.sin(rotSpeed) + dirY * Math.cos(rotSpeed);
        const oldPlaneX = planeX;
        planeX = planeX * Math.cos(rotSpeed) - planeY * Math.sin(rotSpeed);
        planeY = oldPlaneX * Math.sin(rotSpeed) + planeY * Math.cos(rotSpeed);
      }

      requestAnimationFrame(gameLoop);
    }

    gameLoop();
  </script>
</body>
</html>
